---
title: "Resample Substrate"
author: "Elke Windschitl"
date: "2023-04-18"
output: html_document
---

Load necessary libraries

```{r}
library(tidyverse)
library(raster)
library(terra)
```

Load data

```{r}
mask <- terra::rast("/capstone/kelpgeomod/new_file_structure/02-intermediate-data/mask/mask_rast.tif")
substrate <- raster("/capstone/kelpgeomod/new_file_structure/02-intermediate-data/substrate/SBC_substrate.tif")
```

Make binary
```{r}
substrate <- substrate %>%
  reclassify(cbind(0, 1, 0))

m <- c(0, 0, 1,
       0.25, 0.5, 2,
       0.5, 1, 3)
rclmat <- matrix(m, ncol=3, byrow=TRUE)
rc1 <- classify(r, rclmat, include.lowest=TRUE)

df <- as.data.frame(substrate, xy = TRUE)

```


Resample substrate to the mask

```{r}

# Check the crs, and reset the crs if different
crs(substrate) == crs(mask)

# Resample to mask resolution
resampled_sub <- terra::resample(x = substrate,
                                   y = mask,
                                   method = "near")

# Convert the resampled raster to a factor
resampled_factor <- as.factor(resampled_sub)

# Calculate the count of each category in each grid cell
count_raster <- tabulate(resampled_sub)

# Calculate the total number of cells in each grid cell
total_cells <- cellStats(resampled_factor, "count")

# Calculate the percentage of each category in each grid cell
percentage_raster <- count_raster / total_cells * 100

```

